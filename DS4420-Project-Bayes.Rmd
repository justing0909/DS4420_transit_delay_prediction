---
title: "DS4420-Project-Bayes"
author: "Eddy Liu"
date: "2025-04-12"
output: html_document
---



# load libs
```{r}

library(data.table)
library(caret)
library(mvnfast)
library(geoR)
library(MCMCpack)
library(brms)

```

# load data
```{r}

mw <- read.csv("ruggles_to_dtxg_january_scaled.csv")
scaled <- data.frame(scale(mw[,-c(1,2,3,4,5)]))
scaled$travel_time <- mw$travel_time_sec

## set seed for reproducability
set.seed(102)

# create partition indicies
part <- createDataPartition(scaled[,3],
                            p=0.8, # (80% training 20% test)
                            list=FALSE # returned as a matrix
                            )


mbta_train <- scaled[ part,]
mbta_test  <- scaled[-part,]
mbta_train

```

# use brms
```{r}

# normally distributed weights
prior <- default_prior(
  travel_time ~ temperature_2m...C. + wind_speed_10m..km.h. + cloud_cover.... + visibility..m.,
  data = mbta_train,
  family = gaussian()
)

# define posterior
mbta_brm <- brm(
  travel_time ~ temperature_2m...C. + wind_speed_10m..km.h. + cloud_cover.... + visibility..m.,
  data = mbta_train,
  family = gaussian(),
  prior = prior,
  chains = 4,
  iter = 10000,
  warmup = 1800,
  cores = 4,
  file = "mbta_model_v5.rds"
)
```

# check model confidence
```{r}
# check summary and R2
summary(mbta_brm)

# plot posterior histograms / traceplots
plot(mbta_brm) 

# bayes_R2
bayes_R2(mbta_brm)
```

# perform predictions
```{r}
# get posterior predictions for test data 
post_preds_test <- posterior_predict(
  mbta_brm,
  newdata = mbta_test,
)

# print col means
predicted_delay <- colMeans(post_preds_test)
predicted_delay
```
# get acc:
```{r}

cor(predicted_delay,mbta_test["travel_time"])

```



